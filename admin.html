<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ç®¡ç†å¾Œå° | Management Backend - UVACO</title>
<link rel="stylesheet" href="styles.css">
</head>

<body class="theme-dark lang-zh">

<!-- èƒŒæ™¯æ³¡æ³¡ -->
<div class="bg-blob blob1"></div>
<div class="bg-blob blob2"></div>

<div class="admin-page-container">
  <!-- å·¦å´é‚Šæ¬„ -->
  <aside class="admin-sidebar">
    <a href="yuyuko.html" class="admin-sidebar-back">
      <span>â†</span>
      <span class="lang-zh">è¿”å›</span>
      <span class="lang-en">Back</span>
    </a>
    
    <h1 class="admin-sidebar-title">UVACO</h1>
  </aside>

  <!-- ä¸»å…§å®¹å€ -->
  <main class="admin-content">
    <div class="admin-content-header">
      <div class="admin-header-left">
        <h1 class="admin-content-title lang-zh">åç‰‡åˆ—è¡¨</h1>
        <h1 class="admin-content-title lang-en">Business Card List</h1>
      </div>
      <div class="admin-menu-button-wrapper">
        <button class="admin-menu-button" onclick="toggleAdminMenu()">
          <span class="admin-menu-button-icon">â˜°</span>
          <span class="admin-menu-button-text lang-zh">é¸å–®</span>
          <span class="admin-menu-button-text lang-en">Menu</span>
        </button>
        <div class="admin-menu-dropdown" id="adminMenuDropdown">
          <a href="admin.html" class="admin-menu-dropdown-item active">
            <span class="admin-menu-dropdown-icon">ğŸ“‹</span>
            <span class="lang-zh">åç‰‡åˆ—è¡¨</span>
            <span class="lang-en">Business Card List</span>
          </a>
          <a href="issue.html" class="admin-menu-dropdown-item">
            <span class="admin-menu-dropdown-icon">â•</span>
            <span class="lang-zh">ç™¼æ”¾åç‰‡</span>
            <span class="lang-en">Issue Business Card</span>
          </a>
          <a href="company-settings.html" class="admin-menu-dropdown-item">
            <span class="admin-menu-dropdown-icon">âš™ï¸</span>
            <span class="lang-zh">å…¬å¸è¨­å®š</span>
            <span class="lang-en">Company Settings</span>
          </a>
          <a href="statistics.html" class="admin-menu-dropdown-item">
            <span class="admin-menu-dropdown-icon">ğŸ“Š</span>
            <span class="lang-zh">çµ±è¨ˆå ±è¡¨</span>
            <span class="lang-en">Statistical Report</span>
          </a>
        </div>
      </div>
    </div>

    <!-- å·¥å…·åˆ— -->
    <div class="admin-toolbar">
      <input 
        type="text" 
        class="admin-search" 
        placeholder="æœå°‹å§“åã€å…¬å¸..."
        data-placeholder-zh="æœå°‹å§“åã€å…¬å¸..."
        data-placeholder-en="Search name, company..."
        id="adminSearchInput"
        onkeyup="handleAdminSearch(event)"
      >
      <button class="admin-btn admin-btn-primary lang-zh" onclick="exportCards()">åŒ¯å‡º</button>
      <button class="admin-btn admin-btn-primary lang-en" onclick="exportCards()">Export</button>
    </div>

    <!-- æ‰¹é‡æ“ä½œæŒ‰éˆ• -->
    <div class="admin-toolbar" id="batchActions" style="display: none;">
      <button class="admin-btn admin-btn-danger lang-zh" onclick="batchDisable()">åœç”¨</button>
      <button class="admin-btn admin-btn-danger lang-en" onclick="batchDisable()">Disable</button>
      <button class="admin-btn admin-btn-primary lang-zh" onclick="batchExport()">åŒ¯å‡º</button>
      <button class="admin-btn admin-btn-primary lang-en" onclick="batchExport()">Export</button>
    </div>

    <!-- è¡¨æ ¼ -->
    <div class="admin-table-wrapper">
      <table class="admin-table">
        <thead>
          <tr>
            <th style="width: 40px;">
              <input type="checkbox" class="admin-table-checkbox" id="selectAll" onchange="toggleSelectAll()">
            </th>
            <th style="width: 30%;">
              <span class="lang-zh">å§“å</span>
              <span class="lang-en">Name</span>
            </th>
            <th style="width: 35%;">
              <span class="lang-zh">å…¬å¸</span>
              <span class="lang-en">Company</span>
            </th>
            <th style="width: auto;">
              <span class="lang-zh">ç®¡ç†</span>
              <span class="lang-en">Manage</span>
            </th>
          </tr>
        </thead>
        <tbody id="cardsTableBody">
          <!-- ç¯„ä¾‹è³‡æ–™ -->
          <tr>
            <td>
              <input type="checkbox" class="admin-table-checkbox" onchange="updateBatchActions()">
            </td>
            <td>
              <span class="lang-zh">æŸ¯å®œç€…</span>
              <span class="lang-en">Yuyu Ko</span>
            </td>
            <td>UVACO</td>
            <td>
              <div class="admin-table-actions">
                <button class="admin-action-btn lang-zh" onclick="editCard(1)">ç·¨è¼¯</button>
                <button class="admin-action-btn lang-en" onclick="editCard(1)">Edit</button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- ç©ºç‹€æ…‹ -->
    <div class="admin-empty-state" id="emptyState" style="display: none;">
      <div class="admin-empty-icon">ğŸ“‹</div>
      <div class="admin-empty-text lang-zh">ç›®å‰æ²’æœ‰åç‰‡è³‡æ–™</div>
      <div class="admin-empty-text lang-en">No business cards found</div>
    </div>
  </main>
</div>

<!-- åº•éƒ¨å°èˆªæ¬„ -->
<nav class="bottom-nav">
  <a href="directory.html" class="nav-item">
    <span class="nav-icon">ğŸ“‹</span>
    <span class="nav-label lang-zh">é€šè¨ŠéŒ„</span>
    <span class="nav-label lang-en">Directory</span>
  </a>
  <a href="settings.html" class="nav-item">
    <span class="nav-icon">âš™ï¸</span>
    <span class="nav-label lang-zh">è¨­å®š</span>
    <span class="nav-label lang-en">Settings</span>
  </a>
</nav>

<script src="common.js"></script>
<script>
// æ›´æ–°æœå°‹æ¬„ placeholder
function updateAdminSearchPlaceholder() {
  const zhElements = document.querySelectorAll('.lang-zh');
  const currentLang = zhElements.length > 0 && zhElements[0].style.display !== 'none' ? 'zh' : 'en';
  const searchInput = document.getElementById('adminSearchInput');
  if (searchInput) {
    const placeholder = currentLang === 'zh' 
      ? searchInput.getAttribute('data-placeholder-zh')
      : searchInput.getAttribute('data-placeholder-en');
    if (placeholder) {
      searchInput.setAttribute('placeholder', placeholder);
    }
  }
}

// è¦†å¯« setLang å‡½æ•¸ä»¥åŒ…å«ç®¡ç†å¾Œå°çš„æ›´æ–°
const originalSetLang = setLang;
setLang = function(lang) {
  originalSetLang(lang);
  updateAdminSearchPlaceholder();
};

// åˆå§‹åŒ–æ™‚æ›´æ–° placeholder
updateAdminSearchPlaceholder();

// æœå°‹è™•ç†
function handleAdminSearch(event) {
  if (event.key === 'Enter' || event.type === 'keyup') {
    const searchTerm = event.target.value.toLowerCase();
    filterCards(searchTerm);
  }
}

// éæ¿¾åç‰‡
function filterCards(searchTerm) {
  const rows = document.querySelectorAll('#cardsTableBody tr');
  let visibleCount = 0;
  
  rows.forEach(row => {
    const nameCell = row.cells[1];
    const nameZh = nameCell?.querySelector('.lang-zh')?.textContent.toLowerCase() || '';
    const nameEn = nameCell?.querySelector('.lang-en')?.textContent.toLowerCase() || '';
    const company = row.cells[2]?.textContent.toLowerCase() || '';
    
    const matches = nameZh.includes(searchTerm) || 
                   nameEn.includes(searchTerm) || 
                   company.includes(searchTerm);
    
    row.style.display = matches ? '' : 'none';
    if (matches) visibleCount++;
  });
  
  // é¡¯ç¤º/éš±è—ç©ºç‹€æ…‹
  const emptyState = document.getElementById('emptyState');
  const tableWrapper = document.querySelector('.admin-table-wrapper');
  if (visibleCount === 0) {
    emptyState.style.display = 'flex';
    tableWrapper.style.display = 'none';
  } else {
    emptyState.style.display = 'none';
    tableWrapper.style.display = 'block';
  }
}

// å…¨é¸/å–æ¶ˆå…¨é¸
function toggleSelectAll() {
  const selectAll = document.getElementById('selectAll');
  const checkboxes = document.querySelectorAll('#cardsTableBody .admin-table-checkbox');
  checkboxes.forEach(checkbox => {
    checkbox.checked = selectAll.checked;
  });
  updateBatchActions();
}

// æ›´æ–°æ‰¹é‡æ“ä½œæŒ‰éˆ•é¡¯ç¤º
function updateBatchActions() {
  const checkboxes = document.querySelectorAll('#cardsTableBody .admin-table-checkbox:checked');
  const batchActions = document.getElementById('batchActions');
  if (checkboxes.length > 0) {
    batchActions.style.display = 'flex';
  } else {
    batchActions.style.display = 'none';
  }
}

// æ‰¹é‡åœç”¨
function batchDisable() {
  const checkboxes = document.querySelectorAll('#cardsTableBody .admin-table-checkbox:checked');
  if (checkboxes.length === 0) {
    alert('è«‹é¸æ“‡è¦åœç”¨çš„åç‰‡');
    return;
  }
  
  const zhElements = document.querySelectorAll('.lang-zh');
  const currentLang = zhElements.length > 0 && zhElements[0].style.display !== 'none' ? 'zh' : 'en';
  const msg = currentLang === 'zh' 
    ? `ç¢ºå®šè¦åœç”¨ ${checkboxes.length} å¼µåç‰‡å—ï¼Ÿ`
    : `Are you sure you want to disable ${checkboxes.length} business cards?`;
  
  if (confirm(msg)) {
    // é€™è£¡å¯ä»¥é€£æ¥å¯¦éš›çš„ API
    alert(currentLang === 'zh' ? 'å·²åœç”¨é¸å–çš„åç‰‡' : 'Selected cards have been disabled');
    checkboxes.forEach(checkbox => {
      checkbox.checked = false;
    });
    document.getElementById('selectAll').checked = false;
    updateBatchActions();
  }
}

// æ‰¹é‡åŒ¯å‡º
function batchExport() {
  const checkboxes = document.querySelectorAll('#cardsTableBody .admin-table-checkbox:checked');
  if (checkboxes.length === 0) {
    alert('è«‹é¸æ“‡è¦åŒ¯å‡ºçš„åç‰‡');
    return;
  }
  
  const zhElements = document.querySelectorAll('.lang-zh');
  const currentLang = zhElements.length > 0 && zhElements[0].style.display !== 'none' ? 'zh' : 'en';
  const msg = currentLang === 'zh' 
    ? `ç¢ºå®šè¦åŒ¯å‡º ${checkboxes.length} å¼µåç‰‡å—ï¼Ÿ`
    : `Are you sure you want to export ${checkboxes.length} business cards?`;
  
  if (confirm(msg)) {
    // é€™è£¡å¯ä»¥é€£æ¥å¯¦éš›çš„åŒ¯å‡º API
    alert(currentLang === 'zh' ? 'åŒ¯å‡ºåŠŸèƒ½é–‹ç™¼ä¸­' : 'Export feature coming soon');
  }
}

// åŒ¯å‡ºæ‰€æœ‰åç‰‡
function exportCards() {
  const zhElements = document.querySelectorAll('.lang-zh');
  const currentLang = zhElements.length > 0 && zhElements[0].style.display !== 'none' ? 'zh' : 'en';
  const msg = currentLang === 'zh' ? 'åŒ¯å‡ºåŠŸèƒ½é–‹ç™¼ä¸­' : 'Export feature coming soon';
  alert(msg);
}

// ç·¨è¼¯åç‰‡
function editCard(id) {
  window.location.href = 'edit.html';
}

// åˆ‡æ›é¸å–®
function toggleAdminMenu() {
  const dropdown = document.getElementById('adminMenuDropdown');
  dropdown.classList.toggle('show');
}

// é»æ“Šå¤–éƒ¨é—œé–‰é¸å–®
document.addEventListener('click', function(event) {
  const menuButton = document.querySelector('.admin-menu-button');
  const dropdown = document.getElementById('adminMenuDropdown');
  
  if (!menuButton.contains(event.target) && !dropdown.contains(event.target)) {
    dropdown.classList.remove('show');
  }
});
</script>

</body>
</html>

