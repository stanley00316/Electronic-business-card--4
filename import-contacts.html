<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>åŒ¯å…¥è¯çµ¡äºº | Import Contacts - UVACO</title>
<link rel="stylesheet" href="styles.css">
<style>
body {
  padding-bottom: 0;
}
.import-page {
  width: 100%;
  max-width: 800px;
  margin: 0 auto;
  min-height: 100vh;
  padding: 20px;
  padding-top: 80px;
  padding-bottom: 100px;
}
</style>
</head>

<body class="theme-dark lang-zh">

<!-- èƒŒæ™¯æ³¡æ³¡ -->
<div class="bg-blob blob1"></div>
<div class="bg-blob blob2"></div>

<!-- åŒ¯å…¥è¯çµ¡äººé é¢å…§å®¹ -->
<div class="import-page">
  <div class="settings-panel">
    <div class="settings-header">
      <h2 class="settings-title lang-zh">åŒ¯å…¥è¯çµ¡äºº</h2>
      <h2 class="settings-title lang-en">Import Contacts</h2>
      <a href="settings.html" class="settings-close">âœ•</a>
    </div>
    
    <!-- åŒ¯å…¥æ–¹å¼é¸æ“‡ -->
    <div class="import-methods">
      <div class="import-method-card" onclick="selectImportMethod('file')">
        <div class="import-method-icon"><img src="file-icon.svg" alt="File" style="width: 32px; height: 32px;"></div>
        <div class="import-method-content">
          <div class="import-method-title lang-zh">å¾æª”æ¡ˆåŒ¯å…¥</div>
          <div class="import-method-title lang-en">Import from File</div>
          <div class="import-method-subtitle lang-zh">æ”¯æ´ CSVã€VCF æ ¼å¼</div>
          <div class="import-method-subtitle lang-en">Supports CSV, VCF formats</div>
        </div>
        <div class="import-method-arrow">â†’</div>
      </div>
      
      <div class="import-method-card" onclick="selectImportMethod('phone')">
        <div class="import-method-icon"><img src="mobile-icon.svg" alt="Mobile" style="width: 32px; height: 32px;"></div>
        <div class="import-method-content">
          <div class="import-method-title lang-zh">å¾æ‰‹æ©ŸåŒ¯å…¥</div>
          <div class="import-method-title lang-en">Import from Phone</div>
          <div class="import-method-subtitle lang-zh">æƒæ QR Code æˆ–è¼¸å…¥é€£çµ</div>
          <div class="import-method-subtitle lang-en">Scan QR Code or enter link</div>
        </div>
        <div class="import-method-arrow">â†’</div>
      </div>
    </div>

    <!-- æª”æ¡ˆä¸Šå‚³å€åŸŸ -->
    <div class="import-upload-section" id="fileUploadSection" style="display: none;">
      <h3 class="import-section-title lang-zh">é¸æ“‡æª”æ¡ˆ</h3>
      <h3 class="import-section-title lang-en">Select File</h3>
      
      <div class="import-upload-area" id="uploadArea" onclick="document.getElementById('fileInput').click()">
        <input type="file" id="fileInput" accept=".csv,.vcf,.txt" style="display: none;" onchange="handleFileSelect(event)">
        <div class="import-upload-icon">ğŸ“¤</div>
        <div class="import-upload-text lang-zh">é»æ“Šæˆ–æ‹–æ”¾æª”æ¡ˆåˆ°æ­¤è™•</div>
        <div class="import-upload-text lang-en">Click or drag file here</div>
        <div class="import-upload-hint lang-zh">æ”¯æ´ CSVã€VCF æ ¼å¼ï¼Œæœ€å¤§ 10MB</div>
        <div class="import-upload-hint lang-en">Supports CSV, VCF formats, max 10MB</div>
      </div>
      
      <div class="import-file-info" id="fileInfo" style="display: none;">
        <div class="import-file-name" id="fileName"></div>
        <button class="import-remove-btn" onclick="removeFile()">âœ•</button>
      </div>
    </div>

    <!-- æ‰‹æ©ŸåŒ¯å…¥å€åŸŸ -->
    <div class="import-phone-section" id="phoneImportSection" style="display: none;">
      <h3 class="import-section-title lang-zh">æ‰‹æ©ŸåŒ¯å…¥</h3>
      <h3 class="import-section-title lang-en">Phone Import</h3>
      
      <div class="import-qr-section">
        <div class="import-qr-code">
          <div class="import-qr-placeholder">
            <div class="import-qr-icon"><img src="mobile-icon.svg" alt="QR Code" style="width: 48px; height: 48px;"></div>
            <div class="lang-zh">QR Code å°‡åœ¨æ­¤é¡¯ç¤º</div>
            <div class="lang-en">QR Code will appear here</div>
          </div>
        </div>
        <div class="import-qr-instructions">
          <p class="lang-zh">1. ä½¿ç”¨æ‰‹æ©Ÿæƒæ QR Code</p>
          <p class="lang-en">1. Scan QR Code with your phone</p>
          <p class="lang-zh">2. é¸æ“‡è¦åŒ¯å…¥çš„è¯çµ¡äºº</p>
          <p class="lang-en">2. Select contacts to import</p>
          <p class="lang-zh">3. ç¢ºèªåŒ¯å…¥</p>
          <p class="lang-en">3. Confirm import</p>
        </div>
      </div>
      
      <div class="import-link-section">
        <div class="admin-form-group">
          <label class="admin-form-label lang-zh">æˆ–è¼¸å…¥åˆ†äº«é€£çµ</label>
          <label class="admin-form-label lang-en">Or enter share link</label>
          <input type="text" class="admin-form-input" id="shareLink" placeholder="https://...">
        </div>
        <button class="admin-btn admin-btn-primary" onclick="importFromLink()">
          <span class="lang-zh">åŒ¯å…¥</span>
          <span class="lang-en">Import</span>
        </button>
      </div>
    </div>

    <!-- é è¦½å€åŸŸ -->
    <div class="import-preview-section" id="previewSection" style="display: none;">
      <h3 class="import-section-title lang-zh">é è¦½åŒ¯å…¥è³‡æ–™</h3>
      <h3 class="import-section-title lang-en">Preview Import Data</h3>
      
      <div class="import-preview-info">
        <div class="import-preview-count lang-zh">
          å…± <span id="previewCount">0</span> ç­†è¯çµ¡äºº
        </div>
        <div class="import-preview-count lang-en">
          Total <span id="previewCountEn">0</span> contacts
        </div>
        <div class="import-preview-actions">
          <button class="admin-btn admin-btn-secondary" onclick="selectAllContacts()">
            <span class="lang-zh">å…¨é¸</span>
            <span class="lang-en">Select All</span>
          </button>
          <button class="admin-btn admin-btn-secondary" onclick="deselectAllContacts()">
            <span class="lang-zh">å–æ¶ˆå…¨é¸</span>
            <span class="lang-en">Deselect All</span>
          </button>
        </div>
      </div>
      
      <div class="import-preview-list" id="previewList">
        <!-- å‹•æ…‹ç”Ÿæˆé è¦½é …ç›® -->
      </div>
    </div>

    <!-- æ“ä½œæŒ‰éˆ• -->
    <div class="import-actions" id="importActions" style="display: none;">
      <button class="admin-btn admin-btn-secondary" onclick="cancelImport()">
        <span class="lang-zh">å–æ¶ˆ</span>
        <span class="lang-en">Cancel</span>
      </button>
      <button class="admin-btn admin-btn-primary" onclick="confirmImport()">
        <span class="lang-zh">ç¢ºèªåŒ¯å…¥</span>
        <span class="lang-en">Confirm Import</span>
      </button>
    </div>

    <!-- åŒ¯å…¥çµæœ -->
    <div class="import-result" id="importResult" style="display: none;">
      <div class="import-result-icon" id="resultIcon">âœ“</div>
      <div class="import-result-title lang-zh" id="resultTitle">åŒ¯å…¥æˆåŠŸ</div>
      <div class="import-result-title lang-en" id="resultTitleEn">Import Successful</div>
      <div class="import-result-message lang-zh" id="resultMessage"></div>
      <div class="import-result-message lang-en" id="resultMessageEn"></div>
      <button class="admin-btn admin-btn-primary" onclick="resetImport()">
        <span class="lang-zh">ç¹¼çºŒåŒ¯å…¥</span>
        <span class="lang-en">Continue Import</span>
      </button>
    </div>
  </div>
</div>

<!-- åº•éƒ¨å°èˆªæ¬„ -->
<nav class="bottom-nav">
  <a href="directory.html" class="nav-item">
    <span class="nav-icon">ğŸ“‹</span>
    <span class="nav-label lang-zh">é€šè¨ŠéŒ„</span>
    <span class="nav-label lang-en">Directory</span>
  </a>
  <a href="settings.html" class="nav-item">
    <span class="nav-icon">âš™ï¸</span>
    <span class="nav-label lang-zh">è¨­å®š</span>
    <span class="nav-label lang-en">Settings</span>
  </a>
</nav>

<script src="common.js"></script>
<script>
let selectedFile = null;
let contactsData = [];
let selectedContacts = [];

// é¸æ“‡åŒ¯å…¥æ–¹å¼
function selectImportMethod(method) {
  document.getElementById('fileUploadSection').style.display = method === 'file' ? 'block' : 'none';
  document.getElementById('phoneImportSection').style.display = method === 'phone' ? 'block' : 'none';
  document.getElementById('previewSection').style.display = 'none';
  document.getElementById('importActions').style.display = 'none';
  document.getElementById('importResult').style.display = 'none';
  
  // é‡ç½®ç‹€æ…‹
  selectedFile = null;
  contactsData = [];
  selectedContacts = [];
}

// è™•ç†æª”æ¡ˆé¸æ“‡
function handleFileSelect(event) {
  const file = event.target.files[0];
  if (!file) return;
  
  // æª¢æŸ¥æª”æ¡ˆå¤§å°ï¼ˆ10MBï¼‰
  if (file.size > 10 * 1024 * 1024) {
    const zhElements = document.querySelectorAll('.lang-zh');
    const currentLang = zhElements.length > 0 && zhElements[0].style.display !== 'none' ? 'zh' : 'en';
    alert(currentLang === 'zh' ? 'æª”æ¡ˆå¤§å°ä¸èƒ½è¶…é 10MB' : 'File size cannot exceed 10MB');
    return;
  }
  
  selectedFile = file;
  document.getElementById('fileName').textContent = file.name;
  document.getElementById('fileInfo').style.display = 'flex';
  
  // è®€å–æª”æ¡ˆ
  const reader = new FileReader();
  reader.onload = function(e) {
    parseFile(file.name, e.target.result);
  };
  reader.readAsText(file);
}

// è§£ææª”æ¡ˆ
function parseFile(fileName, content) {
  const extension = fileName.split('.').pop().toLowerCase();
  
  if (extension === 'csv') {
    parseCSV(content);
  } else if (extension === 'vcf') {
    parseVCF(content);
  } else {
    const zhElements = document.querySelectorAll('.lang-zh');
    const currentLang = zhElements.length > 0 && zhElements[0].style.display !== 'none' ? 'zh' : 'en';
    alert(currentLang === 'zh' ? 'ä¸æ”¯æ´çš„æª”æ¡ˆæ ¼å¼' : 'Unsupported file format');
  }
}

// è§£æ CSV
function parseCSV(content) {
  const lines = content.split('\n').filter(line => line.trim());
  if (lines.length < 2) {
    const zhElements = document.querySelectorAll('.lang-zh');
    const currentLang = zhElements.length > 0 && zhElements[0].style.display !== 'none' ? 'zh' : 'en';
    alert(currentLang === 'zh' ? 'CSV æª”æ¡ˆæ ¼å¼éŒ¯èª¤' : 'CSV file format error');
    return;
  }
  
  const headers = lines[0].split(',').map(h => h.trim());
  contactsData = [];
  
  for (let i = 1; i < lines.length; i++) {
    const values = lines[i].split(',').map(v => v.trim());
    if (values.length < 2) continue;
    
    const contact = {
      name: values[0] || '',
      phone: values[1] || '',
      email: values[2] || '',
      company: values[3] || '',
      position: values[4] || ''
    };
    contactsData.push(contact);
    selectedContacts.push(i - 1);
  }
  
  showPreview();
}

// è§£æ VCF
function parseVCF(content) {
  const vcards = content.split('BEGIN:VCARD').filter(v => v.trim());
  contactsData = [];
  
  vcards.forEach((vcard, index) => {
    const lines = vcard.split('\n');
    const contact = {
      name: '',
      phone: '',
      email: '',
      company: '',
      position: ''
    };
    
    lines.forEach(line => {
      if (line.startsWith('FN:')) {
        contact.name = line.substring(3).trim();
      } else if (line.startsWith('TEL')) {
        const telMatch = line.match(/TEL[;:].*:(.+)/);
        if (telMatch) contact.phone = telMatch[1].trim();
      } else if (line.startsWith('EMAIL')) {
        const emailMatch = line.match(/EMAIL[;:].*:(.+)/);
        if (emailMatch) contact.email = emailMatch[1].trim();
      } else if (line.startsWith('ORG:')) {
        contact.company = line.substring(4).trim();
      } else if (line.startsWith('TITLE:')) {
        contact.position = line.substring(6).trim();
      }
    });
    
    if (contact.name) {
      contactsData.push(contact);
      selectedContacts.push(index);
    }
  });
  
  showPreview();
}

// é¡¯ç¤ºé è¦½
function showPreview() {
  document.getElementById('previewSection').style.display = 'block';
  document.getElementById('importActions').style.display = 'flex';
  
  const zhElements = document.querySelectorAll('.lang-zh');
  const currentLang = zhElements.length > 0 && zhElements[0].style.display !== 'none' ? 'zh' : 'en';
  
  document.getElementById('previewCount').textContent = contactsData.length;
  document.getElementById('previewCountEn').textContent = contactsData.length;
  
  const previewList = document.getElementById('previewList');
  previewList.innerHTML = '';
  
  contactsData.forEach((contact, index) => {
    const item = document.createElement('div');
    item.className = 'import-preview-item';
    item.innerHTML = `
      <input type="checkbox" class="import-preview-checkbox" id="contact${index}" checked onchange="toggleContact(${index})">
      <div class="import-preview-content">
        <div class="import-preview-name">${contact.name || '<span class="lang-zh">æœªå‘½å</span><span class="lang-en">Unnamed</span>'}</div>
        <div class="import-preview-details">
          ${contact.phone ? `<span><img src="phone-icon.svg" alt="Phone" style="width: 16px; height: 16px; vertical-align: middle; margin-right: 4px;"> ${contact.phone}</span>` : ''}
          ${contact.email ? `<span><img src="email-icon.svg" alt="Email" style="width: 16px; height: 16px; vertical-align: middle; margin-right: 4px;"> ${contact.email}</span>` : ''}
          ${contact.company ? `<span>ğŸ¢ ${contact.company}</span>` : ''}
          ${contact.position ? `<span><img src="linkedin-logo.svg" alt="Position" style="width: 16px; height: 16px; vertical-align: middle; margin-right: 4px;"> ${contact.position}</span>` : ''}
        </div>
      </div>
    `;
    previewList.appendChild(item);
  });
  
  // æ›´æ–°èªè¨€é¡¯ç¤º
  setLang(currentLang);
}

// åˆ‡æ›è¯çµ¡äººé¸æ“‡
function toggleContact(index) {
  const checkbox = document.getElementById(`contact${index}`);
  if (checkbox.checked) {
    if (!selectedContacts.includes(index)) {
      selectedContacts.push(index);
    }
  } else {
    selectedContacts = selectedContacts.filter(i => i !== index);
  }
}

// å…¨é¸
function selectAllContacts() {
  contactsData.forEach((_, index) => {
    const checkbox = document.getElementById(`contact${index}`);
    if (checkbox) {
      checkbox.checked = true;
      if (!selectedContacts.includes(index)) {
        selectedContacts.push(index);
      }
    }
  });
}

// å–æ¶ˆå…¨é¸
function deselectAllContacts() {
  contactsData.forEach((_, index) => {
    const checkbox = document.getElementById(`contact${index}`);
    if (checkbox) {
      checkbox.checked = false;
    }
  });
  selectedContacts = [];
}

// ç§»é™¤æª”æ¡ˆ
function removeFile() {
  selectedFile = null;
  contactsData = [];
  selectedContacts = [];
  document.getElementById('fileInput').value = '';
  document.getElementById('fileInfo').style.display = 'none';
  document.getElementById('previewSection').style.display = 'none';
  document.getElementById('importActions').style.display = 'none';
}

// å¾é€£çµåŒ¯å…¥
function importFromLink() {
  const link = document.getElementById('shareLink').value.trim();
  if (!link) {
    const zhElements = document.querySelectorAll('.lang-zh');
    const currentLang = zhElements.length > 0 && zhElements[0].style.display !== 'none' ? 'zh' : 'en';
    alert(currentLang === 'zh' ? 'è«‹è¼¸å…¥åˆ†äº«é€£çµ' : 'Please enter share link');
    return;
  }
  
  // é€™è£¡å¯ä»¥é€£æ¥å¯¦éš›çš„ API
  const zhElements = document.querySelectorAll('.lang-zh');
  const currentLang = zhElements.length > 0 && zhElements[0].style.display !== 'none' ? 'zh' : 'en';
  alert(currentLang === 'zh' ? 'é€£çµåŒ¯å…¥åŠŸèƒ½é–‹ç™¼ä¸­' : 'Link import feature coming soon');
}

// å–æ¶ˆåŒ¯å…¥
function cancelImport() {
  if (confirm('ç¢ºå®šè¦å–æ¶ˆåŒ¯å…¥å—ï¼Ÿ')) {
    resetImport();
  }
}

// ç¢ºèªåŒ¯å…¥
function confirmImport() {
  if (selectedContacts.length === 0) {
    const zhElements = document.querySelectorAll('.lang-zh');
    const currentLang = zhElements.length > 0 && zhElements[0].style.display !== 'none' ? 'zh' : 'en';
    alert(currentLang === 'zh' ? 'è«‹è‡³å°‘é¸æ“‡ä¸€å€‹è¯çµ¡äºº' : 'Please select at least one contact');
    return;
  }
  
  // é€™è£¡å¯ä»¥é€£æ¥å¯¦éš›çš„ API
  const zhElements = document.querySelectorAll('.lang-zh');
  const currentLang = zhElements.length > 0 && zhElements[0].style.display !== 'none' ? 'zh' : 'en';
  
  const importedContacts = selectedContacts.map(i => contactsData[i]);
  
  // é¡¯ç¤ºçµæœ
  document.getElementById('previewSection').style.display = 'none';
  document.getElementById('importActions').style.display = 'none';
  document.getElementById('importResult').style.display = 'block';
  
  document.getElementById('resultIcon').textContent = 'âœ“';
  document.getElementById('resultIcon').style.color = 'var(--uvaco-green)';
  
  if (currentLang === 'zh') {
    document.getElementById('resultTitle').style.display = 'block';
    document.getElementById('resultTitleEn').style.display = 'none';
    document.getElementById('resultMessage').textContent = `æˆåŠŸåŒ¯å…¥ ${importedContacts.length} ç­†è¯çµ¡äºº`;
    document.getElementById('resultMessage').style.display = 'block';
    document.getElementById('resultMessageEn').style.display = 'none';
  } else {
    document.getElementById('resultTitle').style.display = 'none';
    document.getElementById('resultTitleEn').style.display = 'block';
    document.getElementById('resultMessageEn').textContent = `Successfully imported ${importedContacts.length} contacts`;
    document.getElementById('resultMessage').style.display = 'none';
    document.getElementById('resultMessageEn').style.display = 'block';
  }
}

// é‡ç½®åŒ¯å…¥
function resetImport() {
  selectedFile = null;
  contactsData = [];
  selectedContacts = [];
  document.getElementById('fileInput').value = '';
  document.getElementById('fileInfo').style.display = 'none';
  document.getElementById('previewSection').style.display = 'none';
  document.getElementById('importActions').style.display = 'none';
  document.getElementById('importResult').style.display = 'none';
  document.getElementById('fileUploadSection').style.display = 'none';
  document.getElementById('phoneImportSection').style.display = 'none';
}

// æ‹–æ”¾åŠŸèƒ½
const uploadArea = document.getElementById('uploadArea');
uploadArea.addEventListener('dragover', (e) => {
  e.preventDefault();
  uploadArea.style.background = 'rgba(31, 175, 83, 0.1)';
});

uploadArea.addEventListener('dragleave', () => {
  uploadArea.style.background = '';
});

uploadArea.addEventListener('drop', (e) => {
  e.preventDefault();
  uploadArea.style.background = '';
  const file = e.dataTransfer.files[0];
  if (file) {
    document.getElementById('fileInput').files = e.dataTransfer.files;
    handleFileSelect({ target: { files: [file] } });
  }
});
</script>

</body>
</html>

