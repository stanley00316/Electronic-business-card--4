<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>UVACOï½œé›»å­åç‰‡ | E-Business Card</title>
<link rel="stylesheet" href="styles.css">
<!-- Supabase JSï¼ˆCDNï¼‰ -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="cloud.js?v=20251231"></script>
</head>

<body class="theme-dark lang-zh">

<!-- èƒŒæ™¯æ³¡æ³¡ -->
<div class="bg-blob blob1"></div>
<div class="bg-blob blob2"></div>

<!-- LOGO å€ -->
<div class="hero">
  <div class="hero-frame">
    <img src="uvaco-logo.svg" class="hero-logo" alt="UVACO" id="viewerLogo">
  </div>
</div>

<!-- è³‡æ–™å¡ -->
<div class="card" id="previewCard">

  <!-- å¤§é ­ç…§ï¼ˆæ”¾ç½®æ–¼å¡ç‰‡å³ä¸Šè§’ï¼‰ -->
  <img class="avatar" src="default-avatar.svg" alt="Avatar" loading="lazy" id="viewerAvatar">

  <!-- å§“å -->
  <div class="name lang-zh" id="viewerNameZh">æŸ¯å®œç€… ï½œ <span class="en">Yuyu Ko</span></div>
  <div class="name lang-en" id="viewerNameEn">Yuyu Ko ï½œ <span class="en">Ko</span></div>

  <!-- è·å‹™ -->
  <div class="tagline lang-zh" id="viewerTitleZh">æ¥­å‹™ç¶“ç†</div>
  <div class="tagline lang-en" id="viewerTitleEn">Sales Manager</div>

  <!-- æ¨™èª -->
  <div class="tagline lang-zh">å¥åº·ãƒ»äº‹æ¥­ãƒ»æœªä¾†</div>
  <div class="tagline lang-zh"><strong id="viewerCompanyStrongZh">è‘¡çœ¾ä¼æ¥­ï½œå°ˆæ¥­é™ªä¼´</strong></div>

  <div class="tagline lang-en">Health â€¢ Business â€¢ Future</div>
  <div class="tagline lang-en"><strong id="viewerCompanyStrongEn">Puzhong Enterprise | Professional Support</strong></div>

  <div class="divider"></div>

  <!-- å…¬å¸è³‡è¨Šå€å¡Š -->
  <div class="company-info-section" id="companyInfoSection">
    <div class="section-label lang-zh">å…¬å¸è³‡è¨Š COMPANY INFO</div>
    <div class="section-label lang-en">COMPANY INFO</div>
    
    <!-- çµ±ä¸€ç·¨è™Ÿï¼ˆå¯é¸ï¼‰ -->
    <div class="info-item info-item-tax" id="taxIdItem" style="display: none;">
      <span class="info-label lang-zh">çµ±ä¸€ç·¨è™Ÿï¼š</span>
      <span class="info-label lang-en">Tax ID:</span>
      <span class="info-value lang-zh" id="previewTaxIdZh">12345678</span>
      <span class="info-value lang-en" id="previewTaxIdEn">12345678</span>
    </div>
    
    <!-- æœå‹™æ“šé»ï¼ˆå¯é¸ï¼‰ -->
    <div class="info-item info-item-location" id="serviceLocationItem" style="display: none;">
      <span class="info-label lang-zh">æœå‹™æ“šé»ï¼š</span>
      <span class="info-label lang-en">Service Location:</span>
      <span class="info-value lang-zh" id="previewServiceLocationZh">
        <span class="address-text">å°åŒ—å¸‚ä¿¡ç¾©å€ä¿¡ç¾©è·¯äº”æ®µ7è™Ÿ</span>
        <span class="address-map-link" onclick="openMap('serviceLocation', event)">ğŸ“ åœ°åœ–</span>
      </span>
      <span class="info-value lang-en" id="previewServiceLocationEn">
        <span class="address-text">No. 7, Section 5, Xinyi Road, Xinyi District, Taipei</span>
        <span class="address-map-link" onclick="openMap('serviceLocation', event)">ğŸ“ Map</span>
      </span>
    </div>
    
    <!-- é€šè¨Šä½å€ï¼ˆå¯é¸ï¼‰ -->
    <div class="info-item info-item-location" id="mailingAddressItem" style="display: none;">
      <span class="info-label lang-zh">é€šè¨Šä½å€ï¼š</span>
      <span class="info-label lang-en">Mailing Address:</span>
      <span class="info-value lang-zh" id="previewMailingAddressZh">
        <span class="address-text">å°åŒ—å¸‚ä¿¡ç¾©å€ä¿¡ç¾©è·¯äº”æ®µ7è™Ÿ</span>
        <span class="address-map-link" onclick="openMap('mailingAddress', event)">ğŸ“ åœ°åœ–</span>
      </span>
      <span class="info-value lang-en" id="previewMailingAddressEn">
        <span class="address-text">No. 7, Section 5, Xinyi Road, Xinyi District, Taipei</span>
        <span class="address-map-link" onclick="openMap('mailingAddress', event)">ğŸ“ Map</span>
      </span>
    </div>
    
    <!-- å…¬å¸ä½å€ï¼ˆå¯é¸ï¼‰ -->
    <div class="info-item info-item-location" id="companyAddressItem" style="display: none;">
      <span class="info-label lang-zh">å…¬å¸ä½å€ï¼š</span>
      <span class="info-label lang-en">Company Address:</span>
      <span class="info-value lang-zh" id="previewCompanyAddressZh">
        <span class="address-text">å°åŒ—å¸‚ä¿¡ç¾©å€ä¿¡ç¾©è·¯äº”æ®µ7è™Ÿ</span>
        <span class="address-map-link" onclick="openMap('companyAddress', event)">ğŸ“ åœ°åœ–</span>
      </span>
      <span class="info-value lang-en" id="previewCompanyAddressEn">
        <span class="address-text">No. 7, Section 5, Xinyi Road, Xinyi District, Taipei</span>
        <span class="address-map-link" onclick="openMap('companyAddress', event)">ğŸ“ Map</span>
      </span>
    </div>
  </div>

  <div class="divider"></div>

  <!-- æ¨™é¡Œï¼šè¯çµ¡æ–¹å¼ -->
  <div class="section-label lang-zh">è¯çµ¡æ–¹å¼ CONTACT</div>
  <div class="section-label lang-en">CONTACT</div>

  <!-- æŒ‰éˆ•ç¾¤çµ„ -->
  <div class="btn-group">

    <!-- Call -->
    <a class="btn btn-primary lang-zh" href="tel:0905519002" id="viewerPhoneZh">
      <img src="phone-icon.svg" alt="Phone" class="btn-icon-phone"> ç«‹å³ä¾†é›»
    </a>
    <a class="btn btn-primary lang-en" href="tel:0905519002" id="viewerPhoneEn">
      <img src="phone-icon.svg" alt="Phone" class="btn-icon-phone"> Call Now
    </a>

    <!-- LINE -->
    <a class="btn btn-secondary lang-zh" href="https://line.me/R/ti/p/2sSjJ_o6OT" target="_blank">
      <img src="line-logo.svg" alt="LINE" class="btn-icon-line"> åŠ å…¥ LINE
    </a>
    <a class="btn btn-secondary lang-en" href="https://line.me/R/ti/p/2sSjJ_o6OT" target="_blank">
      <img src="line-logo.svg" alt="LINE" class="btn-icon-line"> Add LINE
    </a>    

    <!-- Email -->
    <a class="btn btn-secondary lang-zh" href="mailto:ccccwoho@gmail.com" id="viewerEmailZh">
      <img src="email-icon.svg" alt="Email" class="btn-icon-email"> å¯„é€ Email
    </a>
    <a class="btn btn-secondary lang-en" href="mailto:ccccwoho@gmail.com" id="viewerEmailEn">
      <img src="email-icon.svg" alt="Email" class="btn-icon-email"> Send Email
    </a>

    <!-- Facebook -->
    <a class="btn btn-secondary lang-zh" href="https://www.facebook.com/share/17nfDH1ZQR/?mibextid=wwXIfr" target="_blank">
      <img src="facebook-logo.svg" alt="Facebook" class="btn-icon-facebook"> Facebook
    </a>
    <a class="btn btn-secondary lang-en" href="https://www.facebook.com/share/17nfDH1ZQR/?mibextid=wwXIfr" target="_blank">
      <img src="facebook-logo.svg" alt="Facebook" class="btn-icon-facebook"> Facebook
    </a>

    <!-- VCF -->
    <a class="btn btn-secondary lang-zh" href="yuyu-ko.vcf" download="YuyuKo.vcf">
      <img src="file-icon.svg" alt="VCF" class="btn-icon-file"> å„²å­˜åˆ°é€šè¨ŠéŒ„ï¼ˆVCFï¼‰
    </a>
    <a class="btn btn-secondary lang-en" href="yuyu-ko.vcf" download="YuyuKo.vcf">
      <img src="file-icon.svg" alt="VCF" class="btn-icon-file"> Save Contact (VCF)
    </a>

  </div>

  <!-- æç¤ºæ–‡å­— -->
  <div class="hint lang-zh">
    è‹¥æ‚¨é€é <strong>NFC åç‰‡</strong> æˆ–åˆ†äº«é€£çµé–‹å•Ÿæ­¤é ï¼Œæˆ‘æœƒç›¡å¿«å›è¦†æ‚¨ã€‚
  </div>
  <div class="hint lang-en">
    If you opened this page via <strong>NFC card</strong> or shared link, I will respond as soon as possible.
  </div>

</div>

<!-- åº•éƒ¨å°èˆªæ¬„ -->
<nav class="bottom-nav">
  <a href="directory.html" class="nav-item">
    <span class="nav-icon">ğŸ“‹</span>
    <span class="nav-label lang-zh">é€šè¨ŠéŒ„</span>
    <span class="nav-label lang-en">Directory</span>
  </a>
  <a href="settings.html" class="nav-item">
    <span class="nav-icon">âš™ï¸</span>
    <span class="nav-label lang-zh">è¨­å®š</span>
    <span class="nav-label lang-en">Settings</span>
  </a>
</nav>

<script src="common.js"></script>
<script>
// åˆå§‹åŒ–é é¢ï¼š
// - è‹¥å·²ç™»å…¥ä¸”æœ‰é›²ç«¯åç‰‡ï¼šé¡¯ç¤ºè‡ªå·±çš„åç‰‡è³‡æ–™ï¼ˆå¾ Supabase è®€å–ï¼‰
// - å¦å‰‡ï¼šé¡¯ç¤ºæœ¬é é è¨­ç¯„ä¾‹
document.addEventListener('DOMContentLoaded', function () {
  (async function () {
    let ownerTheme = 1;
    try {
      if (window.UVACO_CLOUD && UVACO_CLOUD.hasConfig()) {
        // è‹¥æ˜¯ magic link å›è·³ï¼Œå…ˆäº¤æ› session
        await UVACO_CLOUD.exchangeCodeForSessionIfNeeded();
        const params = new URLSearchParams(window.location.search || '');
        const uid = params.get('uid');

        // è‹¥è¦é è¦½ä»–äººï¼šå¿…é ˆç™»å…¥ï¼ˆå…¨å¹³å°å…¬é–‹æœå°‹æ¨¡å¼ï¼‰
        if (uid) {
          const here = 'yuyuko.html' + (window.location.search || '');
          const r = await UVACO_CLOUD.requireAuth(here);
          if (!r.ok) return;
        }

        const s = await UVACO_CLOUD.getSession();
        if (s && s.session) {
          const res = uid ? await UVACO_CLOUD.getCardByUserId(uid) : await UVACO_CLOUD.getMyCard();
          if (res && res.card) {
            const card = res.card;
            ownerTheme = parseInt(card.theme || 1, 10) || 1;

            let pj = card.profile_json;
            if (typeof pj === 'string') {
              try { pj = JSON.parse(pj); } catch (e) { pj = null; }
            }
            pj = (pj && typeof pj === 'object') ? pj : {};

            const safeText = (v) => String(v ?? '').replace(/\s+/g, ' ').trim();

            // ä¸»è¦æ¬„ä½ï¼šé›™èªå„ªå…ˆç”¨ profile_jsonï¼Œæ²’æœ‰å† fallback åˆ° cards æ¬„ä½
            const nameZh = safeText(pj.nameZh) || safeText(card.name);
            const nameEn = safeText(pj.nameEn) || safeText(card.name);
            const titleZh = safeText(pj.titleZh) || safeText(card.title);
            const titleEn = safeText(pj.titleEn) || safeText(card.title);
            const companyZh = safeText(pj.companyZh) || safeText(card.company);
            const companyEn = safeText(pj.companyEn) || safeText(card.company);

            const setText = (id, val) => {
              const el = document.getElementById(id);
              if (el) el.textContent = val || el.textContent;
            };

            // æ›´æ–°åç¨±/è·å‹™/å…¬å¸
            // æ³¨æ„ï¼šname å¯èƒ½åŒ…å«ã€Œï½œã€åˆ†éš”ï¼Œé€™è£¡ä¿ç•™åŸå­—ä¸²ä»¥ç¬¦åˆä½ çš„é¡¯ç¤ºç¿’æ…£
            const nameZhEl = document.getElementById('viewerNameZh');
            const nameEnEl = document.getElementById('viewerNameEn');
            if (nameZhEl && nameZh) nameZhEl.innerHTML = nameZh;
            if (nameEnEl && nameEn) nameEnEl.innerHTML = nameEn;
            setText('viewerTitleZh', titleZh);
            setText('viewerTitleEn', titleEn);
            setText('viewerCompanyStrongZh', companyZh);
            setText('viewerCompanyStrongEn', companyEn);

            // æ›´æ–° logo / avatar
            const logo = document.getElementById('viewerLogo');
            const avatar = document.getElementById('viewerAvatar');
            if (logo) {
              if (pj.logoPath) {
                const u = await UVACO_CLOUD.getSignedAssetUrl(String(pj.logoPath), { bucket: 'card-assets', expiresIn: 3600 });
                if (u && u.url) logo.setAttribute('src', u.url);
              } else if (pj.logoSrc) {
                logo.setAttribute('src', String(pj.logoSrc));
              }
            }
            if (avatar) {
              if (pj.avatarPath) {
                const u = await UVACO_CLOUD.getSignedAssetUrl(String(pj.avatarPath), { bucket: 'card-assets', expiresIn: 3600 });
                if (u && u.url) avatar.setAttribute('src', u.url);
              } else if (pj.avatarSrc) {
                avatar.setAttribute('src', String(pj.avatarSrc));
              }
            }

            // æ›´æ–° phone/email é€£çµ
            const phone = safeText(card.phone);
            if (phone) {
              const aZh = document.getElementById('viewerPhoneZh');
              const aEn = document.getElementById('viewerPhoneEn');
              if (aZh) aZh.setAttribute('href', 'tel:' + phone);
              if (aEn) aEn.setAttribute('href', 'tel:' + phone);
            }
            const email = safeText(card.email);
            if (email) {
              const mZh = document.getElementById('viewerEmailZh');
              const mEn = document.getElementById('viewerEmailEn');
              if (mZh) mZh.setAttribute('href', 'mailto:' + email);
              if (mEn) mEn.setAttribute('href', 'mailto:' + email);
            }
          }
        }
      }
    } catch (e) {
      // ignore â†’ fallback to sample
    } finally {
      // card ä¸»é¡Œä½¿ç”¨ ownerThemeï¼›èƒŒæ™¯ä½¿ç”¨è§€çœ‹è€…ä¸»é¡Œï¼ˆlocalStorageï¼‰
      initViewerPage(ownerTheme);
    }
  })();
});

// é–‹å•Ÿåœ°åœ–
function openMap(addressType, event) {
  event.stopPropagation();
  event.preventDefault();
  
  const typeCapitalized = addressType.charAt(0).toUpperCase() + addressType.slice(1);
  const zhEl = document.getElementById(`preview${typeCapitalized}Zh`);
  const enEl = document.getElementById(`preview${typeCapitalized}En`);
  
  const address = zhEl?.querySelector('.address-text')?.textContent || enEl?.querySelector('.address-text')?.textContent || '';
  
  if (address && address !== 'ï¼ˆæœªè¨­å®šï¼‰' && address !== 'ï¼ˆNot Setï¼‰') {
    const encodedAddress = encodeURIComponent(address);
    const mapUrl = `https://www.google.com/maps/search/?api=1&query=${encodedAddress}`;
    window.open(mapUrl, '_blank');
  }
}
</script>

</body>
</html>
